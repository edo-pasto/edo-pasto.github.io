<!DOCTYPE html>
<html lang="en">

<head>
    <title>MammaMia - Data Visualization Assignments</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link type="image/png" sizes="32x32" rel="icon" href="images/favicon.ico">
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.6.1.js"
        integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
    <!-- Google Font CDN -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Fontawesome -->
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
        integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <!--D3.js table-->
    <script src="https://d3js.org/d3.v4.js"></script>

</head>

<body class="w3-light-grey">

    <!-- Top container -->
    <div id="includeHeader">

    </div>

    <!-- Sidebar/menu -->
    <nav class="w3-sidebar w3-collapse w3-white w3-animate-left" id="mySidebar">

    </nav>


    <!-- Overlay effect when opening sidebar on small screens -->
    <div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer"
        title="close side menu" id="myOverlay"></div>

    <!-- !PAGE CONTENT! -->
    <div class="w3-main" id="assignm1PageContent">

        <!-- Header -->
        <header class="w3-container" id="assignm1Title">
            <h1><i class="fa fa-chart-line fa-2xl"></i> Assignment 1</h1>
        </header>
<br>

        <div class="w3-row-padding w3-margin-bottom">
            <br>
            <h2>Chart 1 - BarChart</h2>
            <div class="task-container" id="task1"></div>
            <hr>
            <br>
            <h2>Chart 2 - Stacked BarChart</h2>
            <div class="task-container" id="task2"></div>
            <hr>
            <br>
            <h2>Chart 3 - Small Multiple</h2>
            <div class="task-container" id="task3"></div>
            <hr>
            <br>
            <h2>Chart 4 - Percent Stacked BarChart</h2>
            <div class="task-container" id="task4"></div>
            <hr>
            <br>
            <h2>Chart 5 - Waffle Chart</h2>
            <div class="task-container" id="task5"></div>
        </div>




        <!-- Footer -->
        <div id="includeFooter">

        </div>


        <!-- End page content -->
    </div>

    <script>
        // Get the Sidebar
        var mySidebar = document.getElementById("mySidebar");

        // Get the DIV with overlay effect
        var overlayBg = document.getElementById("myOverlay");

        // Toggle between showing and hiding the sidebar, and add overlay effect
        function w3_open() {
            if (mySidebar.style.display === 'block') {
                mySidebar.style.display = 'none';
                overlayBg.style.display = "none";
            } else {
                mySidebar.style.display = 'block';
                overlayBg.style.display = "block";
            }
        }

        // Close the sidebar with the close button
        function w3_close() {
            mySidebar.style.display = "none";
            overlayBg.style.display = "none";
        }

        $(function () {
            $("#includeFooter").load("./components/footer.html");
        });
        $(function () {
            $("#includeHeader").load("./components/header.html");
        });
        $(function () {
            $("#mySidebar").load("./components/sidebar.html");
        });




    </script>
    <script src="https://kit.fontawesome.com/22c153e680.js" crossorigin="anonymous"></script>
    <!-- <script src="./js/assignment1/task1.js" crossorigin="anonymous"></script> -->
    <!-- <script src="./js/assignment1/task2.js" crossorigin="anonymous"></script> -->


    <script>

        // -------------- First Chart -------------

        const margin = { top: 20, right: 30, bottom: 40, left: 250 },
            width = 800 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        const svg = d3.select("#task1")
            .append("svg")
            // .attr("width", width + margin.left + margin.right)
            // .attr("height", height + margin.top + margin.bottom)
            .attr("viewBox", `0 0 1000 500`)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        const geo_url = "https://raw.githubusercontent.com/edo-pasto/edo-pasto.github.io/main/data/top_10_trees.csv";

        //test_url="https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/7_OneCatOneNum_header.csv"
        // Parse the Data
        d3.csv(geo_url, function (data) {

            // Add X axis
            const x = d3.scaleLinear()
                .domain([0, 1300])
                .range([0, width]);
            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end");

            // Y axis
            const y = d3.scaleBand()
                .range([0, height])
                .domain(data.map(function (d) {
                    return d.Name;
                }))
                .padding(.1);
            svg.append("g")
                .call(d3.axisLeft(y))


            const tooltip = d3.select("#task1")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "1px")
                .style("border-radius", "5px")
                .style("padding", "10px")

            // Three function that change the tooltip when user hover / move / leave a cell
            const mouseover = function (d) {
                const totalAmount = d.Count;
                const treeType = d.Name;
                const canopyMean = d["Mean Canopy Cover (m2)"];
                tooltip
                    .html("Tree Type: " + treeType + "<br>" + "Total Amount: " + totalAmount + "<br>" + "Canopy mean: " + canopyMean)
                    .style("opacity", 1)
            }
            const mousemove = function (d) {
                tooltip
                    .style("left", (d3.mouse(this)[0] + 750) + "px") // It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect
                    .style("top", (d3.mouse(this)[1] + 320) + "px")
            }
            const mouseleave = function (d) {
                tooltip
                    .style("opacity", 0)
            }

            //Bars
            svg.selectAll("myRect")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", x(0))
                .attr("y", function (d) {
                    return y(d.Name);
                })
                .attr("width", function (d) {
                    return x(d.Count);

                })
                .attr("height", y.bandwidth())
                .attr("fill", "#69b3a2")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)


            // .attr("x", function(d) { return x(d.Country); })
            // .attr("y", function(d) { return y(d.Value); })
            // .attr("width", x.bandwidth())
            // .attr("height", function(d) { return height - y(d.Value); })
            // .attr("fill", "#69b3a2")

            //Animation
            //     svg.selectAll("rect")
            //         .transition()
            //         .duration(800)
            //         .attr("x", function (d) { return x(d.Count); })
            //         .attr("width", function (d) { return width - x(d.Count) })
            //         .delay(function (d, i) { console.log(i); return (i * 100) })

        })



        //----------- Second Chart --------------
        height2 = 400 - margin.top - margin.bottom;
        var svg2 = d3.select("#task2")
            .append("svg")
            // .attr("width", width + margin.left + margin.right)
            // .attr("height", height + margin.top + margin.bottom)
            .attr("viewBox", `0 0 1000 500`)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // Parse the Data
        d3.csv("/data/top_trees_neighborhood.csv", function (data) {
            // List of subgroups = header of the csv files = soil condition here
            var subgroups = data.columns.slice(1)
            // List of groups = species here = value of the first column called group -> I show them on the X axis
            var groups = d3.map(data, function (d) {
                return (d.Neighborhood)
            }).keys()
            // Add X axis
            var x = d3.scaleBand()
                .domain(groups)
                .range([0, width])
                .padding([0.2])
            svg2.append("g")
                .attr("transform", "translate(0," + height2 + ")")
                .call(d3.axisBottom(x).tickSizeOuter(0))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end");

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([0, 3000])
                .range([height2, 0]);
            svg2.append("g")
                .call(d3.axisLeft(y));
            // color palette = one color per subgroup
            var color = d3.scaleOrdinal()
                .domain(subgroups)
                .range(['#e41a1c', '#377eb8', '#4daf4a', '#3c51ae', '#fff1a9', '#bb3366'])
            //stack the data? --> stack per subgroup
            var stackedData = d3.stack()
                .keys(subgroups)
                (data)


            // ----------------
            // Create a tooltip
            // ----------------
            var tooltip2 = d3.select("#task2")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "1px")
                .style("border-radius", "5px")
                .style("padding", "10px")

            // Three function that change the tooltip when user hover / move / leave a cell
            var mouseover2 = function (d) {
                var subgroupName = d3.select(this.parentNode).datum().key;
                var subgroupValue = d.data[subgroupName];
                tooltip2
                    .html("Tree Type: " + subgroupName + "<br>" + "Amount: " + subgroupValue)
                    .style("opacity", 1)
            }
            var mousemove2 = function (d) {
                tooltip2
                    .style("left", (d3.mouse(this)[0] + 700) + "px") // It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect
                    .style("top", (d3.mouse(this)[1] + 1000) + "px")
            }
            var mouseleave2 = function (d) {
                tooltip2
                    .style("opacity", 0)
            }




            // Show the bars
            svg2.append("g")
                .selectAll("g")
                // Enter in the stack data = loop key per key = group per group
                .data(stackedData)
                .enter().append("g")
                .attr("fill", function (d) {
                    return color(d.key);
                })
                .selectAll("rect")
                // enter a second time = loop subgroup per subgroup to add all rectangles
                .data(function (d) {
                    return d;
                })
                .enter().append("rect")
                .attr("x", function (d) {
                    return x(d.data.Neighborhood);
                })
                .attr("y", function (d) {
                    return y(d[1]);
                })
                .attr("height", function (d) {
                    return y(d[0]) - y(d[1]);
                })
                .attr("width", x.bandwidth())
                .on("mouseover", mouseover2)
                .on("mousemove", mousemove2)
                .on("mouseleave", mouseleave2)
        })


        //----------- Third Chart --------------


        //Read the data
        d3.csv("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/5_OneCatSevNumOrdered.csv", function (data) {

            // group the data: I want to draw one line per group
            var sumstat = d3.nest() // nest function allows to group the calculation per level of a factor
                .key(function (d) { return d.name; })
                .entries(data);

            // What is the list of groups?
            allKeys = sumstat.map(function (d) { return d.key })

            // Add an svg element for each group. The will be one beside each other and will go on the next row when no more room available
            var svg3 = d3.select("#task3")
                .selectAll("uniqueChart")
                .data(sumstat)
                .enter()
                .append("svg")
                // .attr("width", width + margin.left + margin.right)
                // .attr("height", height + margin.top + margin.bottom)
                .attr("viewBox", `0 0 1000 500`)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            // Add X axis --> it is a date format
            var x = d3.scaleLinear()
                .domain(d3.extent(data, function (d) { return d.year; }))
                .range([0, width]);
            svg3
                .append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x).ticks(3));

            //Add Y axis
            var y = d3.scaleLinear()
                .domain([0, d3.max(data, function (d) { return +d.n; })])
                .range([height, 0]);
            svg3.append("g")
                .call(d3.axisLeft(y).ticks(5));

            // color palette
            var color = d3.scaleOrdinal()
                .domain(allKeys)
                .range(['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628', '#f781bf', '#999999'])

            // Draw the line
            svg3
                .append("path")
                .attr("fill", "none")
                .attr("stroke", function (d) { return color(d.key) })
                .attr("stroke-width", 1.9)
                .attr("d", function (d) {
                    return d3.line()
                        .x(function (d) { return x(d.year); })
                        .y(function (d) { return y(+d.n); })
                        (d.values)
                })

            // Add titles
            svg3
                .append("text")
                .attr("text-anchor", "start")
                .attr("y", -5)
                .attr("x", 0)
                .text(function (d) { return (d.key) })
                .style("fill", function (d) { return color(d.key) })

        })

        //----------- Fourth Chart --------------
        height4 = 400 - margin.top - margin.bottom;
        var svg4 = d3.select("#task4")
            .append("svg")
            // .attr("width", width + margin.left + margin.right)
            // .attr("height", height + margin.top + margin.bottom)
            .attr("viewBox", `0 0 1000 500`)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // Parse the Data
        d3.csv("/data/top_trees_neighborhood.csv", function (data) {

            // List of subgroups = header of the csv files = soil condition here
            var subgroups = data.columns.slice(1)

            // List of groups = species here = value of the first column called group -> I show them on the X axis
            var groups = d3.map(data, function (d) { return (d.Neighborhood) }).keys()

            // Add X axis
            var x = d3.scaleBand()
                .domain(groups)
                .range([0, width])
                .padding([0.2])
            svg4.append("g")
                .attr("transform", "translate(0," + height4 + ")")
                .call(d3.axisBottom(x).tickSizeOuter(0))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end");

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([0, 100])
                .range([height4, 0]);
            svg4.append("g")
                .call(d3.axisLeft(y));

            // color palette = one color per subgroup
            var color = d3.scaleOrdinal()
                .domain(subgroups)
                .range(['#e41a1c', '#377eb8', '#4daf4a'])

            // Normalize the data -> sum of each group must be 100!
            console.log(data)
            dataNormalized = []
            data.forEach(function (d) {
                // Compute the total
                tot = 0
                for (i in subgroups) { name = subgroups[i]; tot += +d[name] }
                // Now normalize
                for (i in subgroups) { name = subgroups[i]; d[name] = d[name] / tot * 100 }
            })

            //stack the data? --> stack per subgroup
            var stackedData = d3.stack()
                .keys(subgroups)
                (data)


            var tooltip4 = d3.select("#task4")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "1px")
                .style("border-radius", "5px")
                .style("padding", "10px")

            // Three function that change the tooltip when user hover / move / leave a cell
            var mouseover4 = function (d) {
                var subgroupName = d3.select(this.parentNode).datum().key;
                var subgroupValue = d.data[subgroupName];
                tooltip4
                    .html("Tree Type: " + subgroupName + "<br>" + "Amount: " + subgroupValue.toFixed(2) + "%")
                    .style("opacity", 1)
            }
            var mousemove4 = function (d) {
                tooltip4
                    .style("left", (d3.mouse(this)[0] + 700) + "px") // It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect
                    .style("top", (d3.mouse(this)[1] + 2000) + "px")
            }
            var mouseleave4 = function (d) {
                tooltip4
                    .style("opacity", 0)
            }



            // Show the bars
            svg4.append("g")
                .selectAll("g")
                // Enter in the stack data = loop key per key = group per group
                .data(stackedData)
                .enter().append("g")
                .attr("fill", function (d) { return color(d.key); })
                .selectAll("rect")
                // enter a second time = loop subgroup per subgroup to add all rectangles
                .data(function (d) { return d; })
                .enter().append("rect")
                .attr("x", function (d) { return x(d.data.Neighborhood); })
                .attr("y", function (d) { return y(d[1]); })
                .attr("height", function (d) { return y(d[0]) - y(d[1]); })
                .attr("width", x.bandwidth())
                .on("mouseover", mouseover4)
                .on("mousemove", mousemove4)
                .on("mouseleave", mouseleave4)

        })

        //----------- Fifth Chart --------------

    </script>

</body>

</html>